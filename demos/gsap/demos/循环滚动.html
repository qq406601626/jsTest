<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            display: grid;
            place-items: center;
        }

        .wrap {
            position: relative;
        }

        .item {
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-size: 3vw;
            position: absolute;
        }

    </style>
</head>
<body>
<div class="wrap"></div>
</body>
<script type="importmap">
    {
        "imports":{
           "gsap":"../lib/gsap/index.js",
           "scrollTrigger":"../lib/gsap/ScrollTrigger.js",
           "gSDevTools":"../lib/gsap/GSDevTools.js"
        }
    }
</script>

<script type="module">
    import {gsap} from 'gsap'
    import scrollTrigger from 'scrollTrigger'
    import GSDevTools from 'gSDevTools'

    gsap.registerPlugin(scrollTrigger,GSDevTools)

    document.addEventListener("DOMContentLoaded", () => {

        const $wrap = document.querySelector('.wrap')
        const shownCount = 5
        const duration = 1
        const pause = 0.75
        const itemWidth = 11
        const colorArray = ["#eeeeee", "#46a4cc", "#94c356", "#eae047", "#e3aa59", "#a63ba0", "#cf5b21"]
        const createDomes = () => {
            const doc = document.createDocumentFragment()
            const itemList = []
            Array.from({length: 10}).forEach((item, index) => {
                const div = document.createElement('div')
                div.className = 'item'
                div.textContent = index + 1
                itemList.push(div)
                doc.appendChild(div)
            })
            $wrap.appendChild(doc)
            return itemList
        }
        const getRepeatDelay = domes => (domes.length - shownCount) * (pause + duration) - duration
        const setWrapBound = () => {
            gsap.set($wrap, {
                width: `${shownCount * itemWidth}vw`,
                height: `${itemWidth}vw`,
            })
        }
        const setDomesInitBound = domes => {
            gsap.set(domes, {
                backgroundColor: gsap.utils.wrap(colorArray),
                width: `${itemWidth}vw`,
                height: `${itemWidth}vw`,
                right: `${-itemWidth}vw`,
                scale: 0
            })
        }
        const animateDom = (dom,repeatDelay) => {
            const timeLine = gsap.timeline({
                // repeat: -1,
                repeat: 1,
                repeatDelay,
                defaults: {
                    duration,
                    ease: "power3.inOut"
                }
            })
            timeLine.to(dom, {
                scale: 1,
                transformOrigin: "left center",
                xPercent: "-=100"
            });
            for (let i = 1; i < shownCount; i++) {
                timeLine.to(dom, {xPercent: "-=100"}, `+=${pause}`);
            }
            timeLine.to(dom, {
                scale: 0,
                transformOrigin: "right center",
                xPercent: "-=100"
            },`+=${pause}`);
            return timeLine
        }
        setWrapBound()
        const domes = createDomes()
        setDomesInitBound(domes)
        const repeatDelay = getRepeatDelay(domes)
        const parentTimeLine = gsap.timeline({
            id:'parentTimeLine'
        })
        domes.forEach(dom=>{
            const domTimeLine = animateDom(dom,repeatDelay)
            parentTimeLine.add(domTimeLine,`<+${duration+pause}`)
        })
        parentTimeLine.time((shownCount+1) * (duration + pause) - pause)
        GSDevTools.create({
            animation: parentTimeLine
        });
    })
</script>

</html>
